---
import Button from "@components/Button/Button.astro";
import EventCarousel from "./EventCarousel.astro";

import { getKeystaticReader } from "@/lib/keystatic-reader";
const reader = getKeystaticReader();
const homepage = await reader.singletons.homepage.read();
const nextClassStartingSoonTitle =
	homepage?.nextClassStartingSoonTitle || "Next Class Starting Soon";
const nextClassStartingSoonSubtitle = homepage?.nextClassStartingSoonSubtitle || "Seats Limited";
const nextClassStartingArray = homepage?.nextClassStartingArray || [];
---

<div class="relative mt-0 md:block md:w-2/5">
	<div class="relative mr-4 ml-auto w-full max-w-md">
		<div
			class="absolute inset-0 rounded-full bg-gradient-to-br from-red-600/20 to-transparent blur-2xl"
		>
		</div>
		<div
			class="group hover:border-primary-600/50 relative z-10 flex h-full w-full flex-col justify-between overflow-hidden rounded-2xl border border-slate-700 bg-slate-800/50 p-6 backdrop-blur-md transition-colors"
		>
			<div class="absolute top-0 right-0 p-4 opacity-10">
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="200"
					height="200"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					class="lucide lucide-target text-white"
					aria-hidden="true"
					><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle
						cx="12"
						cy="12"
						r="2"></circle></svg
				>
			</div><div>
				<h3 class="mb-2 text-xl font-bold text-white">
					{nextClassStartingSoonTitle}
				</h3><div class="text-primary-600 mb-4 font-mono text-sm uppercase">
					{nextClassStartingSoonSubtitle}
				</div>
			</div>
			<div class="space-y-3">
				{
					nextClassStartingArray.map((item, index) => (
						<div class="flex items-center gap-3 text-slate-300">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="20"
								height="20"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="lucide lucide-circle-check-big text-primary-600"
								aria-hidden="true"
							>
								<>
									<path d="M21.801 10A10 10 0 1 1 17 3.335" />
									<path d="m9 11 3 3L22 4" />
								</>
							</svg>
							<span>{item}</span>
						</div>
					))
				}
			</div>

			<div class="mt-6 block">
				<div id="event-carousel" class="h-full">
					<EventCarousel server:defer>
						<div
							slot="fallback"
							class="active flex h-full items-center justify-between gap-6 rounded-xl border border-slate-700 bg-slate-900/80 p-4"
						>
							<div class="w-3/4">
								<div class="mb-2 text-xs tracking-wide text-slate-400 uppercase">Upcoming</div>
								<div class="event-name text-white transition-all duration-500">
									Loading upcoming courses...
								</div>
							</div>
							<div class="w-1/4 animate-pulse text-right">
								<div class="mb-2 ml-auto h-4 w-12 rounded bg-slate-700"></div>
								<div class="ml-auto h-4 w-8 rounded bg-slate-700/50"></div>
							</div>
						</div>
					</EventCarousel>
				</div>
			</div>

			<Button
				variant="ghost"
				href="#live-schedule"
				arrow="right"
				class="mt-4 w-full border border-slate-700 bg-slate-900/50 text-sm font-semibold text-white hover:bg-slate-700"
			>
				View All Schedules
			</Button>
		</div>
	</div>
</div>

<style>
	@keyframes fade-in-up {
		0% {
			opacity: 0;
			transform: translateY(20px);
		}
		100% {
			opacity: 1;
			transform: translateY(0);
		}
	}
	.animate-fade-in-up {
		animation: fade-in-up 0.6s ease-out forwards;
	}
</style>
