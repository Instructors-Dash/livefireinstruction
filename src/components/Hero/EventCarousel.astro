---
import { ArrowRight } from "lucide-react";

// Fetch next up to 3 upcoming classes for the sidebar
let nextClasses = [];
try {
	const response = await fetch("https://instructorsdash.com/api/public/events/livefireinstruction");
	if (response.ok) {
		const data = await response.json();
		nextClasses = data.events?.data?.slice(0, 3) || [];
	}
} catch (error) {
	console.error("Error fetching events for Hero Feed:", error);
}

const formatDate = (dateStr: string) => {
	const date = new Date(dateStr);
	return date.toLocaleDateString("en-US", {
		month: "short",
		day: "numeric",
		timeZone: "America/New_York",
	});
};

const formatTime = (dateStr: string) => {
	const date = new Date(dateStr);
	return date.toLocaleTimeString("en-US", {
		hour: "numeric",
		minute: "2-digit",
		hour12: true,
		timeZone: "America/New_York",
	});
};
---

{
	nextClasses.length > 0 ? (
		(() => {
			const item = nextClasses[0];
			return (
				<div class="active flex h-full items-center justify-between gap-6 rounded-xl border border-slate-700 bg-slate-900/80 p-4">
					{item.short_slug && (
						<a
							href={`https://livefireinstruction.instructorsdash.com/e/lisa-chau/${item.short_slug}`}
							target="_blank"
							rel="noopener noreferrer"
							class="regnow regnow-hero text-blue inline-flex items-center gap-2 font-semibold md:text-lg"
							title={item.name}
						>
							<div class="w-3/4">
								<div class="mb-2 text-[10px] tracking-wide text-slate-400 uppercase">Upcoming</div>
								<div class="text-sm text-white">{item.name}</div>
							</div>
							<div class="w-1/4 text-right">
								<div class="text-[10px] font-bold text-slate-400 uppercase">
									{formatDate(item.start_date)}
								</div>
								<div class="text-primary-600/80 text-xs">{formatTime(item.start_date)}</div>
							</div>
						</a>
					)}
				</div>
			);
		})()
	) : (
		<div class="active flex h-full items-center justify-between gap-6 rounded-xl border border-slate-700 bg-slate-900/80 p-4">
			<div class="w-3/4">
				<div class="mb-2 text-xs tracking-wide text-slate-400 uppercase">Upcoming</div>
				<div class="event-name text-white transition-all duration-500">
					First Steps Shooting Course Virginia CCW Permit
				</div>
			</div>
			<div class="w-1/4 text-right">
				<div class="event-date mb-2 text-xs font-bold text-slate-400 uppercase transition-all duration-500">
					Jan 8
				</div>
				<div class="event-time text-primary-600/80 transition-all duration-500">4PM</div>
			</div>
		</div>
	)
}
